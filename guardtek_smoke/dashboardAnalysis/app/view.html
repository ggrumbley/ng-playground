<style type="text/css">
    .widget-group-overlay {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: whitesmoke;
        opacity: 0.6;
        z-index: 10;
    }
</style>

<!-- Whole page loading indicator -->
<div style="width: 100% !important; min-height: 700px !important; display: flex; justify-content: center; flex-direction: column" ng-if="vm.initializing">
    <div style="text-align: center; font-size: 20px; margin-bottom: 3px;">$DashboardModule.Dashboard.DashboardLoading</div>
    <div as-ui-loading style="align-self: center" class="big"></div>
</div>

<div class="container" style="width: 100% !important" class="modal-demo">

    <!-- Welcome note if no widget groups -->
    <div ng-if="vm.noWidgetGroups && !vm.initializing" style="width: 100% !important; min-height: 700px !important; display: flex; justify-content: center;">
        <div style="align-self: center; height: 195px; width: 450px; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.19); position: relative">
            <div style="font-family: 'Open Sans';">
                <div style="font-size: 26px; font-weight: 600; text-align: left; margin-top: 30px; margin-left: 30px; color: #595858;">$DashboardModule.Dashboard.EmptyDashboard.Title</div>
                <div style="font-size: 16px; margin-left: 30px; margin-top: 20px; color: #595858">$DashboardModule.Dashboard.EmptyDashboard.CallToActionToStart</div>
                <div ng-click="vm.openWidgetGroupSettings(null, 'data-settings')" style="position: absolute; right: 14px; bottom: 10px;">
                    <div class="material-button button-green">
                        <i class="mdi mdi-24px mdi-plus"></i>
                    </div>
                </div>
             </div>
        </div>
    </div>
    <div ng-if="!vm.noWidgetGroups">

        <div ng-click="vm.openWidgetGroupSettings(null, 'data-settings')" style="z-index:1000" class="material-button button-absolute-float button-green">
            <i class="mdi mdi-24px mdi-plus"></i>
        </div>

        <div class="row">
            <div class="col-xs-12" style="padding-left: 0px; padding-right: 0px; margin-bottom: 5px;">
                <a id="print-dashboard" class="glyphicon glyphicon-print" style="color: #75bc26; font-size: 15px; display: none" title="Print"></a> <!--Hidden until implemented-->
                <a id="export-dashboard-to-pdf" class="image-button-small icon-pdf" ng-click="vm.exportToPDF()" title="Export to PDF" style="margin-bottom: 7px;"></a>
                <a id="export-dashboard-to-excel" class="glyphicon glyphicon-list-alt" style="color: #75bc26; font-size: 15px; display: none" title="Export to Excel"></a> <!--Hidden until implemented-->
                <a id="send-dashboard" class="glyphicon glyphicon-envelope" style="color: #75bc26; font-size: 15px; display: none" title="Send email"></a> <!--Hidden until implemented-->
            </div>
        </div>

        <div class="row">

            <!-- Gridster -->
            <div id="container">
                <gridster options="vm.gridsterOptions" style="height: 810px; width: 1260px">

                    <!-- Widget Group -->
                    <gridster-item item="widgetGroup"
                                   ng-repeat="widgetGroup in vm.dashboard.WidgetGroups | filter: { PageNo: vm.activePage }"
                                   class="box-border"
                                   ng-click="vm.selectWidgetGroup(widgetGroup);">

                        <!-- Single Widget Group Overlay -->
                        <div class="widget-group-overlay" ng-if="widgetGroup.isInitializing" style="display: flex; justify-content: center; cursor: progress">
                            <div as-ui-loading class="loading-2x" style="align-self: center"></div>
                        </div>

                        <!--Header -->
                        <div class="box-header headerSetting drag-handler {{widgetGroup.Color.Value}}" ng-class="{'box-border' : widgetGroup.Color.Value === 'white'}">
                            <div class="col-xs-9" id="icons" style="padding-left: 3px !important; white-space: nowrap">
                                <div style="vertical-align: middle; display: inline-block;" class="icon {{widgetGroup.Icon.Value}}"></div>
                                <div style="vertical-align: middle; text-overflow: ellipsis; overflow: hidden; display: inline-block; white-space: nowrap; max-width: 100%;" class="caps widget-title">&nbsp;{{widgetGroup.Title}}<span ng-if="widgetGroup.Title">&nbsp;-</span>&nbsp;{{widgetGroup.DateRange.ValueTranslated}}</div> 
                            </div>
                            <div class="col-xs-3 header-widget-controllers widget-title" style="text-align: right; padding: 3px 0 0 0;">
                                <a title="Theme" ng-click="vm.openWidgetGroupSettings(widgetGroup, 'theme')" class="glyphicon glyphicon-pencil {{widgetGroup.Color.Value}}"></a>
                                <a title="Settings" ng-click="vm.openWidgetGroupSettings(widgetGroup, 'data-settings')" class="glyphicon glyphicon-cog {{widgetGroup.Color.Value}}"></a>
                                <a title="Menu" uib-popover-template="'widget-group-popover-template.html'" popover-trigger="'outsideClick'" popover-is-open="widgetGroup.isMenuOpen"
                                   popover-placement="bottom-right" class="glyphicon glyphicon-option-vertical {{widgetGroup.Color.Value}}"></a>
                            </div>
                            <div style="clear: both"></div>
                        </div>
                        
                        <!--Body -->
                        <gridster options="widgetGroup.widgetGroupOptions" class="widgets-gridster">
                        
                            <div > 
                                <ul class="with-3d-shadow with-transitions" id="widget{{$index}}">
                                    <li ng-if="!widgetGroup.Widgets || widgetGroup.Widgets.length === 0" class="box-content">
                                        <img src="../Content/img/views/dashboard/addWidget.png" ng-click="vm.openWidgetSetting(widgetGroup)"/>
                                    </li>
                                    <li>
                                        <!--Widget-->
                                        <gridster-item item="widget" ng-repeat="widget in widgetGroup.Widgets">

                                            <!--Header -->
                                            <div class="widget-header" style="margin-top:2px">
                                                <div style="width:calc(100% - 35px); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; float: left; margin-left: 3px; text-align: left;">{{widget.Title}}</div>
                                                <div style="width: 32px; float: right;">
                                                    <a title="Settings" ng-click="vm.openWidgetSetting(widgetGroup,widget)" class="glyphicon glyphicon-cog"></a>
                                                    <a title="Delete" ng-click="vm.deleteWidget(widgetGroup, widget)" class="glyphicon glyphicon-trash"></a>
                                                </div>
                                                <div style="clear: both"></div>
                                            </div>

                                            <!--Widget Body-->
                                            <div class="{{widget.Color.Value}}" style="height: 100%; width: 100%;">
                                                <div widget-body widget="widget" style="padding-top: 22px; height: 100%" ng-dblClick="vm.openWidgetSetting(widgetGroup,widget)"></div>
                                            </div>

                                        </gridster-item>
                                    </li>
                                </ul>
                            </div>

                        </gridster>

                    </gridster-item>

                </gridster>
            </div>
        </div>

    </div>
</div>
